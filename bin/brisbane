#!/usr/bin/env ruby

$: << File.join(File.dirname(__FILE__), '..', 'lib')

require 'optparse'
require 'brisbane'

options = {}

OptionParser.new do |o|  
  o.banner = 'Usage: brisbane <command> [argument] [options...]'
  
  o.on('--destination DIR') do |arg|
    options[:dest] = arg
  end
  
  o.on('--source DIR') do |arg|
    options[:source] = arg
  end
  
  o.on('--flickr-api-key KEY') do |arg|
    options[:flickr_api_key] = arg
  end
          
  o.parse!(ARGV)
end

command, argument = ARGV[0..1]

Brisbane.configuration(Brisbane::Configuration.new(options, :default).options)

# TODO: We're not always checking the second argument

case command
when 'new'
  Brisbane::Generator.new(argument).process
when 'build'
  Brisbane::Site.new.process
when 'parse'
  Brisbane::Parser.new(argument).process
else
  puts "Invalid command. Run `brisbane --help` for assistance."
  exit 1
end
